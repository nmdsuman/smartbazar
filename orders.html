<!doctype html>
<html lang="bn">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Locker Bazar - My Orders</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>html,body{font-family:Inter,ui-sans-serif,system-ui}</style>
  </head>
  <body class="bg-gray-50 text-gray-900">
    <header class="sticky top-0 z-30 bg-white/90 backdrop-blur border-b border-gray-200">
      <div class="max-w-6xl mx-auto px-4 py-3 flex items-center justify-between">
        <div class="flex items-center gap-3">
          <a href="index.html" class="inline-flex h-9 w-9 items-center justify-center rounded-lg bg-green-600 text-white font-bold">LB</a>
          <div>
            <h1 class="text-lg font-semibold">আমার অর্ডার</h1>
            <p class="text-xs text-gray-500">আপনার অর্ডারের তালিকা</p>
          </div>
        </div>
        <div class="flex items-center gap-2">
          <a href="index.html" class="rounded-lg border border-gray-200 px-3 py-2 text-sm hover:bg-gray-50">হোম</a>
          <button id="logoutBtn" class="hidden rounded-lg border border-gray-200 px-3 py-2 text-sm hover:bg-gray-50">লগআউট</button>
        </div>
      </div>
    </header>

    <main class="max-w-6xl mx-auto px-4 py-4">
      <div id="configAlert" class="hidden mb-3 rounded-lg border border-amber-300 bg-amber-50 text-amber-900 p-3 text-sm">Firebase কনফিগার অনুপস্থিত। <code>__firebase_config</code> এবং <code>__app_id</code> দিন।</div>

      <div id="authWarn" class="hidden mb-3 rounded-lg border border-red-200 bg-red-50 text-red-800 p-3 text-sm">অর্ডার দেখতে লগইন করুন।</div>

      <div class="bg-white border border-gray-200 rounded-2xl p-4">
        <h3 class="text-base font-semibold mb-3">অর্ডার তালিকা</h3>
        <div class="overflow-x-auto">
          <table class="min-w-full text-sm">
            <thead>
              <tr class="border-b bg-gray-50">
                <th class="text-left p-2">অর্ডার ID</th>
                <th class="text-left p-2">মোট</th>
                <th class="text-left p-2">সময়</th>
                <th class="text-left p-2">স্ট্যাটাস</th>
              </tr>
            </thead>
            <tbody id="ordersTbody"></tbody>
          </table>
        </div>
      </div>
    </main>

    <!-- Firebase Config (Provided) -->
    <script>
      window.__firebase_config = {
        apiKey: "AIzaSyAcj9y2jgxqatG3_IXkBjMT0yvBoardpJw",
        authDomain: "bazar-201e6.firebaseapp.com",
        projectId: "bazar-201e6",
        storageBucket: "bazar-201e6.firebasestorage.app",
        messagingSenderId: "465394666878",
        appId: "1:465394666878:web:7f4ecb390746a57baef72f",
        measurementId: "G-3WJ6CCGSYS"
      };
      window.__app_id = "bazar-201e6";
    </script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>

    <script>
      const qs=(s,r=document)=>r.querySelector(s);
      const fmt=(n)=>`৳${(n||0).toLocaleString('bn-BD')}`;
      let app=null,auth=null,db=null,basePath=null,unsub=null;

      async function init(){
        const missing = !(window.__firebase_config && window.__app_id);
        if (missing){ qs('#configAlert').classList.remove('hidden'); return; }
        app=firebase.initializeApp(window.__firebase_config);
        auth=firebase.auth();
        db=firebase.firestore();
        basePath=`artifacts/${window.__app_id}/public/data`;
        qs('#configAlert').classList.add('hidden');
      }

      function renderOrdersFor(uid){
        if (unsub) unsub();
        unsub = db.collection(`${basePath}/orders`).where('userId','==',uid).orderBy('createdAt','desc').onSnapshot(snap=>{
          const tb=qs('#ordersTbody'); tb.innerHTML='';
          snap.forEach(doc=>{
            const o={ id:doc.id, ...doc.data() };
            const created=o.createdAt?.toDate?o.createdAt.toDate():null;
            const tr=document.createElement('tr');
            tr.className='border-b';
            tr.innerHTML=`
              <td class="p-2 font-mono text-xs">${o.id}</td>
              <td class="p-2">${fmt(o.totalAmount)}</td>
              <td class="p-2">${created?created.toLocaleString('bn-BD'):''}</td>
              <td class="p-2">${o.status||'Pending'}</td>`;
            tb.appendChild(tr);
          });
        });
      }

      window.addEventListener('DOMContentLoaded', async ()=>{
        await init();
        if (!auth) return;
        auth.onAuthStateChanged(user=>{
          const warn = qs('#authWarn');
          const logoutBtn = qs('#logoutBtn');
          if (!user || user.isAnonymous){ warn.classList.remove('hidden'); logoutBtn.classList.add('hidden'); return; }
          warn.classList.add('hidden'); logoutBtn.classList.remove('hidden');
          renderOrdersFor(user.uid);
        });
        qs('#logoutBtn').addEventListener('click', async ()=>{ try{ await auth.signOut(); window.location.href='index.html'; }catch(e){} });
      });
    </script>
  </body>
</html>
