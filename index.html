<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Bazar — Home</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="icon" href="data:,">
  <script type="importmap">
  {
    "imports": {
      "firebase/app": "https://www.gstatic.com/firebasejs/10.13.1/firebase-app.js",
      "firebase/auth": "https://www.gstatic.com/firebasejs/10.13.1/firebase-auth.js",
      "firebase/firestore": "https://www.gstatic.com/firebasejs/10.13.1/firebase-firestore.js",
      "firebase/analytics": "https://www.gstatic.com/firebasejs/10.13.1/firebase-analytics.js"
    }
  }
  </script>
</head>
<body class="bg-gray-50 text-gray-900">
  <header class="bg-white border-b">
    <div class="max-w-6xl mx-auto px-4 py-4 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <button id="menu-open" class="flex items-center gap-2 px-3 py-2 rounded-full bg-green-600 text-white hover:bg-green-700">
          <span class="inline-block w-4 h-0.5 bg-white"></span>
          <span class="inline-block w-4 h-0.5 bg-white -mt-1"></span>
          <span class="inline-block w-4 h-0.5 bg-white -mt-1"></span>
          <span class="ml-1">Menu</span>
        </button>
        <a href="index.html" class="text-xl font-bold">Bazar</a>
      </div>
      <nav class="flex items-center gap-4">
        <a href="index.html" class="hover:text-blue-600">Home</a>
        <a href="admin.html" class="hover:text-blue-600">Admin</a>
        <a href="profile.html" class="hover:text-blue-600">Profile</a>
        <a href="orders.html" class="hover:text-blue-600">Orders</a>
        <a href="cart.html" class="relative hover:text-blue-600">
          Cart
          <span id="cart-count" class="ml-1 inline-flex items-center justify-center text-xs rounded-full bg-blue-600 text-white w-5 h-5">0</span>
        </a>
        <a href="login.html" id="login-link" class="hover:text-blue-600">Login</a>
        <button id="logout-btn" data-logout class="hidden px-3 py-1 rounded bg-gray-100 hover:bg-gray-200">Logout</button>
      </nav>
    </div>
  </header>

  <!-- Category Drawer -->
  <div id="cat-drawer" class="fixed inset-y-0 left-0 w-80 max-w-[85vw] bg-white shadow-2xl translate-x-[-100%] transition-transform duration-300 z-50">
    <div class="flex items-center justify-between px-4 py-3 border-b">
      <div class="font-semibold">Menu</div>
      <button id="menu-close" class="px-2 py-1 rounded bg-gray-100 hover:bg-gray-200">Close</button>
    </div>
    <div id="cat-menu" class="p-2 overflow-y-auto h-[calc(100%-52px)]"></div>
  </div>
  <div id="cat-backdrop" class="fixed inset-0 bg-black/40 hidden z-40"></div>

  <main class="max-w-6xl mx-auto px-4 py-8">
    <div class="mb-4 grid grid-cols-1 sm:grid-cols-2 gap-3 items-stretch">
      <div class="flex">
        <input id="search-input" type="search" placeholder="Search products..." class="border border-r-0 rounded-l px-3 py-2 flex-1" />
        <button id="search-btn" class="border rounded-r px-3 py-2 bg-blue-600 text-white hover:bg-blue-700">Search</button>
      </div>
      <select id="category-filter" class="border rounded px-3 py-2">
        <option value="">All Categories</option>
      </select>
    </div>
    <div id="products-grid" class="grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 gap-3"></div>
    <div id="empty-state" class="hidden text-gray-500">No products available.</div>
  </main>

  <footer class="border-t bg-white">
    <div class="max-w-6xl mx-auto px-4 py-10 grid grid-cols-1 sm:grid-cols-3 gap-6 text-sm text-gray-700">
      <div>
        <div class="font-semibold mb-2">Bazar</div>
        <p class="text-gray-600">Smart Bazar is a demo ecommerce site for showcasing products and simple ordering.</p>
      </div>
      <div>
        <div class="font-semibold mb-2">About</div>
        <ul class="space-y-1 text-gray-600">
          <li><a href="about.html" class="hover:text-blue-600">Our Story</a></li>
          <li><a href="about.html" class="hover:text-blue-600">Privacy Policy</a></li>
          <li><a href="about.html" class="hover:text-blue-600">Terms of Service</a></li>
        </ul>
      </div>
      <div>
        <div class="font-semibold mb-2">Contact</div>
        <ul class="space-y-1 text-gray-600">
          <li><a href="about.html#contact" class="hover:text-blue-600">Contact details</a></li>
          <li>Email: <a id="contact-email" href="mailto:demo@example.com" class="hover:text-blue-600">demo@example.com</a></li>
          <li>Phone: <a id="contact-phone" href="tel:+8801234567890" class="hover:text-blue-600">+880 1234-567890</a></li>
        </ul>
      </div>
    </div>
    <div class="bg-gray-50 text-center text-xs text-gray-500 py-3">© <span id="year"></span> Bazar. All rights reserved.</div>
  </footer>

  <!-- Options Modal -->
  <div id="opt-modal" class="fixed inset-0 bg-black/50 hidden items-center justify-center z-50">
    <div class="bg-white w-full max-w-md rounded shadow-lg overflow-hidden flex flex-col max-h-[90vh] m-4">
      <div class="px-4 py-3 border-b flex items-center justify-between">
        <h3 class="font-semibold">Select Options</h3>
        <button id="opt-close" class="px-2 py-1 rounded bg-gray-100 hover:bg-gray-200">Close</button>
      </div>
      <div id="opt-body" class="p-4 space-y-3 flex-1 overflow-y-auto">
        <!-- Filled by JS -->
      </div>
      <div class="px-4 py-3 border-t sticky bottom-0 bg-white">
        <div class="flex items-center gap-2">
          <div class="flex items-center rounded overflow-hidden bg-green-600 text-white">
            <button id="opt-minus" class="px-3 py-2 hover:bg-green-700">-</button>
            <span id="opt-qty-view" class="px-4 py-2 border-x border-white/20 select-none">1</span>
            <button id="opt-plus" class="px-3 py-2 hover:bg-green-700">+</button>
          </div>
          <button id="opt-add" class="flex-1 px-4 py-2 rounded bg-green-600 text-white hover:bg-green-700">Add To Cart</button>
        </div>
      </div>
    </div>
  </div>

  <script type="module" src="js/firebase-config.js"></script>
  <script type="module" src="js/auth.js"></script>
  <script type="module" src="js/app.js"></script>
  <script type="module" src="js/categories.js"></script>
  <script type="module" src="js/chat.js"></script>
  <script src="js/mobile-nav.js"></script>
  <script>
    document.getElementById('year').textContent = new Date().getFullYear();
    // Drawer controls
    (function(){
      const openBtn = document.getElementById('menu-open');
      const closeBtn = document.getElementById('menu-close');
      const drawer = document.getElementById('cat-drawer');
      const backdrop = document.getElementById('cat-backdrop');
      function open(){ drawer.style.transform = 'translateX(0)'; backdrop.classList.remove('hidden'); }
      function close(){ drawer.style.transform = 'translateX(-100%)'; backdrop.classList.add('hidden'); }
      openBtn?.addEventListener('click', open);
      closeBtn?.addEventListener('click', close);
      backdrop?.addEventListener('click', close);
      // Render category menu
      function renderCatMenu(){
        const host = document.getElementById('cat-menu'); if (!host) return;
        const cats = (window.categoriesCache || []).slice();
        host.innerHTML = cats.map(c=>{
          const hasSubs = Array.isArray(c.subcategories) && c.subcategories.length>0;
          const arrow = hasSubs ? '<span class="ml-auto text-gray-400">›</span>' : '';
          const subs = hasSubs ? `<div class="sub-list hidden pl-6">
            ${c.subcategories.map(s=>`<button class="sub w-full text-left px-3 py-2 rounded hover:bg-gray-100" data-sub="${s}" data-cat="${c.name}">${s}</button>`).join('')}
          </div>` : '';
          return `<div class="cat-item">
            <button class="cat w-full flex items-center gap-2 px-3 py-2 rounded hover:bg-gray-100" data-cat="${c.name}">
              <span>${c.name}</span>${arrow}
            </button>
            ${subs}
          </div>`;
        }).join('');
        // Wire cats
        host.querySelectorAll('.cat').forEach(btn=>{
          btn.addEventListener('click', ()=>{
            const name = btn.getAttribute('data-cat')||'';
            const wrap = btn.parentElement; const sub = wrap?.querySelector('.sub-list');
            if (sub){ sub.classList.toggle('hidden'); }
            // If no subs: filter directly
            if (!sub){
              const select = document.getElementById('category-filter');
              if (select){ select.value = name; select.dispatchEvent(new Event('change',{bubbles:true})); }
              close();
            }
          });
        });
        // Wire subs
        host.querySelectorAll('.sub').forEach(btn=>{
          btn.addEventListener('click', ()=>{
            const sub = btn.getAttribute('data-sub')||'';
            const select = document.getElementById('category-filter');
            if (select){
              // ensure the sub exists as an option for filtering logic (our filter matches sub too)
              if (!Array.from(select.options).some(o=>o.value===sub)){
                const opt = document.createElement('option'); opt.value=sub; opt.textContent=sub; select.appendChild(opt);
              }
              select.value = sub; select.dispatchEvent(new Event('change',{bubbles:true}));
            }
            close();
          });
        });
      }
      // Populate when categories ready
      if (window.categoriesCache) renderCatMenu();
      window.addEventListener('CategoriesUpdated', renderCatMenu);
    })();
  </script>
</body>
</html>
